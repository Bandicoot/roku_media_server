<html>
<head>
	<script src="jquery.js" type="text/javascript"></script>
	<script src="parseuri.js" type="text/javascript"></script>
	<script src="jplayer.js" type="text/javascript"></script>
	<script>
		$(document).ready(function() {
			var populate = function(container, url) {
				container.hide("fast");

				$.get(url, function(xml) {
					var new_html = $("item", xml).map(function() {
						var url = parseUri($("link", this).text()).relative;
						var type = $("filetype", this).text() || "none";
						return '<a href="' + url + '" type="' + type + '">' + $("title", this).text() + '</a>';
					}).get().join('<br/>');

					container.html(new_html);
					container.show("fast");
				});
			};

			var urlstack = new Array();
			var updateBack = function() {
				if (urlstack.length > 1) {
					$("#back").show();
				} else {
					$("#back").hide();
				}
			};

			$("#jplayer").jPlayer({
				swfPath: "."
			}).jPlayer("onSoundComplete", function() {
				$(".playing").removeClass('playing');
				$("#controls").hide("slow");
			});
			$("#controls").hide();

			
			var target = $("#target");
			var nowPlaying = null;

			target.delegate("a", "click", function() {
				if(this.type == "none") {
					populate(target, this.href);
					urlstack.push(this.href);
					updateBack();
					return false;
				} else {
					$("#jplayer").jPlayer("setFile", this.href)
					$("#jplayer").jPlayer("play");

					// highlight playing
					$(".playing").removeClass("playing");
					$(this).addClass("playing");
					$("#controls:hidden").show("slow");

					nowPlaying = this.href;
					return false;
				}
			});

			var root = "/feed?key=music&dir=.";
			populate(target, root);
			urlstack.push(root);
			updateBack();

			// take us back to the main when title is clicked
			$(".title").click(function() {
				populate(target, root);
				urlstack.splice(0, urlstack.length); // erase the stack
				urlstack.push(root);
				updateBack();
			});

			$("#back").click(function() {
				urlstack.pop(); // the top is where we are right now
				populate(target, urlstack[urlstack.length - 1]);
				updateBack();
			});
		});
	</script>

<style type='text/css'>
	.title {
		background-color: #1994ff;
		color: #ffffff;
		height: 25px;
		border-style: solid;
		border-width: 0px 0px 7px 0px;
		border-color: black;
		text-align: center;
		font-family: sans-serif;
		font-size: 16pt;
		font-style: bold;
		padding: 5px;
	}

	div.title:hover {
		background-color: #84c6ff;
	}

	.block {
		background-color: #e6e6e6;
		color: #333333;
		width: 80%;
		border-style:solid;
		border-width:3px
	}

	#target {
		font-size: 10pt;
		font-family: serif;
		margin: 10px;
	}

	#controls {
		border-style: solid;
		border-width: 7px 0px 0px 0px;
		border-color: black;
	}
	a {
		color: #883333;
		text-decoration: none;
		font-family: sans-serif;
	}

	a:hover {
		color: #1994ff;
		text-decoration: underline;
	}

	.playing {
		background-color: #ffffff;
		color: #333333;
		border-style: solid;
		border-color: black;
		border-width: 1px;
	}

	a.button {
	}

	img {
		border-width: 0px;
		padding: 5px;
	}

</style>

	<title>My Media: Music Player</title>
</head>


<body>
	<div class="block">
		<div class="title">My Music</div>
		<div id="target">
			Loading data...
		</div>
		<a href="#" id="back">[ Go Back]</a>
		
    <div id="controls">
			<center>
			<a href="#" class="button"><img src="play.png" id="jplayer_play"></img></a>
			<a href="#" class="button"><img src="pause.png" id="jplayer_pause"></img></a>
			<a href="#" class="button"><img src="stop.png" id="jplayer_stop"></img></a>
			</center>
			<!--
			<div class="jp-progress">
				<div id="jplayer_load_bar" class="jp-load-bar">
					<div id="jplayer_play_bar" class="jp-play-bar"></div>
				</div>
			</div>
			-->
    </div>

		<div id="jplayer"></div>
	</div>
</body>

</html>
